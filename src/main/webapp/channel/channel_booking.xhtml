<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/resources/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ch="http://java.sun.com/jsf/composite/channel"
                xmlns:pa="http://java.sun.com/jsf/composite/paymentMethod"
                xmlns:au="http://java.sun.com/jsf/composite/autocomplete"
                xmlns:pat="http://java.sun.com/jsf/composite/patient"
                xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp">

    <ui:define name="content">
        <h:form id="form">
            <style >
                .fullHeightListbox,
                .fullHeightListbox .ui-selectlistbox-listcontainer,
                .fullHeightListbox * {
                    box-sizing: border-box;
                    margin: 0;
                    padding: 0;
                }

                .fullHeightListbox .ui-selectlistbox-listcontainer {
                    height: 80% !important;
                }
            </style>

            <div class="row p-0 m-0" >
                <div class="col-12" >
                    <!-- Add Booking Button -->
                    <p:commandButton 
                        ajax="false" 
                        value="Add Booking" 
                        action="#{bookingController.navigateToAddBooking()}"
                        icon="ui-icon-plus" />

                    <!-- View Session Data Button -->
                    <p:commandButton 
                        class="m-1"
                        ajax="false" 
                        value="View Session Data" 
                        action="#{bookingController.navigateToViewSessionData()}"
                        icon="ui-icon-search" />

                    <!-- Manage Booking Button -->
                    <p:commandButton 
                        class="m-1"
                        ajax="false" 
                        value="Manage Booking" 
                        action="#{bookingController.navigateToManageBooking()}"
                        icon="ui-icon-pencil" />

                    <!-- Back to Bookings Button -->
                    <p:commandButton 
                        class="m-1"
                        ajax="false" 
                        value="Back to Bookings" 
                        action="#{bookingController.navigateBackToBookings()}"
                        icon="ui-icon-arrowreturnthick-1-w" />


                </div>
            </div>

            <div  class="row p-0 m-0" style="height: 80%;" >
                <div class="col-md-2 p-0" >
                    <p:watermark for="acSpeciality" value="Select Speciality" ></p:watermark>
                    <p:selectOneListbox 
                        id="acSpeciality"
                        filter="true"
                        value="#{bookingController.speciality}"
                        class="w-100 fullHeightListbox"
                        >
                        <p:ajax  
                            process="@this" 
                            update="scStaff"
                            listener="#{bookingController.listnerStaffListForRowSelect}"/> 
                        <f:selectItems value="#{doctorSpecialityController.selectedItems}"
                                       var="spe" 
                                       itemValue="#{spe}"
                                       itemLabel="#{spe.name}"></f:selectItems>
                    </p:selectOneListbox>
                </div>
                <div class="col-md-2 p-0" >
                    <p:watermark for="scStaff" value="Select Consultant" ></p:watermark>
                    <p:selectOneListbox 
                        id="scStaff"
                        filter="true"
                        value="#{bookingController.staff}"
                        class="w-100 fullHeightListbox"
                        >
                        <p:ajax  
                            process="@this" 
                            update=":#{p:resolveFirstComponentWithId('acSessions',view).clientId}"  
                            listener="#{bookingController.generateSessions}"/>
                        <f:selectItems value="#{bookingController.consultants}"
                                       var="con" 
                                       itemValue="#{con}"
                                       itemLabel="#{con.name}"></f:selectItems>
                    </p:selectOneListbox>
                </div>
                <div class="col-md-4 p-0" >
                    <p:watermark for="acSessions" value="Select Session" ></p:watermark>
                    <p:selectOneListbox 
                        id="acSessions"
                        filter="true"
                        value="#{bookingController.selectedServiceSession}" 
                        class="w-100 fullHeightListbox"
                        var="s">
                        <f:selectItems 
                            value="#{bookingController.serviceSessions}" 
                            var="ses" 
                            itemValue="#{ses}"
                            itemLabel="#{ses.name}"/>
                        <p:column>
                            <h:outputText value="#{s.name}" />
                        </p:column>
                        <p:column style="width: 20px!important; text-align: center;">
                            <h:outputText value="#{s.maxNo}" rendered="#{s.maxNo ne 0}">
                                <f:convertNumber pattern="00" />
                            </h:outputText>
                        </p:column>
                        <p:column style="width: 20px!important; text-align: center;">
                            <h:outputText value="#{s.displayCount}">
                                <f:convertNumber pattern="00" />
                            </h:outputText>
                        </p:column>
                        <p:column style="width: 50px!important; text-align: center;">
                            <h:outputText value="#{s.sessionDate}">
                                <f:convertDateTime pattern="dd MMM"/>
                            </h:outputText>
                        </p:column>
                        <p:column style="width: 40px!important; text-align: center;">
                            <h:outputText value="#{s.startingTime}">
                                <f:convertDateTime pattern="hh:mm"/>
                            </h:outputText>
                        </p:column>
                        <p:column style="width: 40px!important; text-align: center;">
                            <h:outputText value="#{s.totalFee}">
                                <f:convertNumber pattern="#,##0" />
                            </h:outputText>
                        </p:column>

                        <p:ajax event="change" 
                                process="@this"
                                update="acBookings"
                                listener="#{bookingController.fillBillSessions}" />
                    </p:selectOneListbox>
                </div>
                <div class="col-md-4 p-0" >
                    <p:watermark for="acBookings" value="Select Booking" ></p:watermark>
                    <p:selectOneListbox 
                        id="acBookings" 
                        value="#{bookingController.managingBillSession}" 
                        filter="true" 
                        var="bs" 
                        class="w-100 fullHeightListbox">
                        <f:selectItems value="#{bookingController.billSessions}" var="item" itemValue="#{item}" />
                        <p:column style="width: 5px!important;">
                            <h:outputText value="#{bs.serialNo}" />
                        </p:column>

                        <p:column style="width: 60px!important;">
                            <h:outputText value="#{bs.bill.patient.person.nameWithTitle}" />
                        </p:column>

                        <p:column style="width: 20px!important;">
                            <p:outputLabel value="Credit" rendered="#{bs.bill.paidAmount eq 0}" style="color: green;"/>
                            <p:outputLabel value="-On Call" rendered="#{bs.bill.paidAmount eq 0 and bs.bill.paymentMethod eq 'OnCall'}" style="color: green;"/>
                            <p:outputLabel value="-Staff" rendered="#{bs.bill.paidAmount eq 0 and bs.bill.paymentMethod eq 'Staff'}" style="color: green;"/>
                            <p:outputLabel value="Paid" rendered="#{bs.bill.paidAmount ne 0}"/>
                            <p:outputLabel value="-Agent" rendered="#{bs.bill.paidAmount ne 0 and bs.bill.paymentMethod eq 'Agent'}"/>
                            <p:outputLabel value="-On Call" rendered="#{bs.bill.paidAmount ne 0 and bs.bill.paymentMethod eq 'OnCall'}"/>
                            <p:outputLabel value="-Staff" rendered="#{bs.bill.paidAmount ne 0 and bs.bill.paymentMethod eq 'Staff'}"/>
                        </p:column>

                        <p:column style="width: 10px!important;">
                            <p:outputLabel value="Cancelled" rendered="#{bs.bill.cancelled==true}"/>
                            <p:outputLabel value="Refunded" rendered="#{bs.bill.refunded==true}"/>
                        </p:column>

                        <p:column style="width: 5px!important;">
                            <p:outputLabel value="#{bs.bill.creditCompany.institutionCode}"/>
                        </p:column>

                        <p:column style="width: 10px!important;">
                            <p:outputLabel value="Absent" rendered="#{bs.absent}"/>
                        </p:column>

                    </p:selectOneListbox>
                </div>
            </div>


        </h:form>
    </ui:define>
</ui:composition>