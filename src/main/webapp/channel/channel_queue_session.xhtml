<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/resources/template/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ch="http://xmlns.jcp.org/jsf/composite/channel"
                xmlns:pa="http://xmlns.jcp.org/jsf/composite/paymentMethod"
                xmlns:au="http://xmlns.jcp.org/jsf/composite/autocomplete"
                xmlns:pat="http://xmlns.jcp.org/jsf/composite/patient"
                xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp">

    <ui:define name="content">
        <h:form id="form">
            <style >
                .fullHeightListbox,
                .fullHeightListbox .ui-selectlistbox-listcontainer,
                .fullHeightListbox * {
                    box-sizing: border-box;
                    margin: 0;
                    padding: 0;
                }

                .fullHeightListbox .ui-selectlistbox-listcontainer {
                    height: 80vh !important;
                }
            </style>

            <p:panel>
                <f:facet name="header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h:outputText styleClass="fa-solid fa-stethoscope"/>
                            <h:outputText class="mx-4" value="Channel Booking"/>
                        </div>

                        <div class="d-flex justify-content-center align-items-center">
                            <p:commandButton 
                                ajax="false" 
                                value="To Add Booking" 
                                icon="fas fa-plus"
                                class="ui-button-success"

                                action="#{bookingController.navigateToAddBooking()}"
                                />

                            <!-- View Session Data Button -->
                            <p:commandButton 
                                ajax="false" 
                                value="View Session Data"
                                icon="fas fa-eye"
                                class="mx-1 ui-button-primary"
                                action="#{bookingController.navigateToViewSessionData()}"
                                />

                            <p:commandButton 
                                ajax="false" 
                                value="Consulant Room"
                                icon="fas fa-eye"
                                class="mx-1 ui-button-primary"
                                action="#{bookingController.navigateToViewSessionData()}"
                                />

                            <!-- Manage Booking Button -->
                            <p:commandButton 
                                ajax="false" 
                                value="Manage Booking" 
                                class="ui-button-Warning"
                                action="#{bookingController.navigateToManageBooking()}"
                                icon="fa-solid fa-bars-progress" />

                        </div>
                    </div>
                </f:facet>

                <div class="col-4" >
                    <p:watermark for="acBookings" value="Select Booking" ></p:watermark>
                    <h:outputText id="test" value="#{bookingController.selectedBillSession}" rendered="false"></h:outputText>
                    <p:selectOneListbox 
                        id="acBookings" 
                        value="#{bookingController.selectedBillSession}" 
                        filter="true" 

                        var="bs" 
                        class="w-100 fullHeightListbox">
                        <f:selectItems value="#{bookingController.billSessions}" var="item" itemValue="#{item}" />
                        <p:ajax process="acBookings" update="test"></p:ajax>
                        <p:column style="width: 5px!important;">
                            <h:outputText value="#{bs.serialNo}" />
                        </p:column>

                        <p:column style="width: 60px!important;">
                            <h:outputText value="#{bs.bill.patient.person.nameWithTitle}" />
                        </p:column>

                        <p:column style="width: 20px!important;">
                            <p:outputLabel class="badge badge-light" value="Credit" rendered="#{bs.bill.paidAmount eq 0}" style="color: green;"/>
                            <p:outputLabel value="-On Call" rendered="#{bs.bill.paidAmount eq 0 and bs.bill.paymentMethod eq 'OnCall'}" style="color: green;"/>
                            <p:outputLabel value="-Staff" rendered="#{bs.bill.paidAmount eq 0 and bs.bill.paymentMethod eq 'Staff'}" style="color: green;"/>
                            <p:outputLabel value="Paid" rendered="#{bs.bill.paidAmount ne 0}"/>
                            <p:outputLabel value="-Agent" rendered="#{bs.bill.paidAmount ne 0 and bs.bill.paymentMethod eq 'Agent'}"/>
                            <p:outputLabel value="-On Call" rendered="#{bs.bill.paidAmount ne 0 and bs.bill.paymentMethod eq 'OnCall'}"/>
                            <p:outputLabel value="-Staff" rendered="#{bs.bill.paidAmount ne 0 and bs.bill.paymentMethod eq 'Staff'}"/>
                        </p:column>

                        <p:column style="width: 10px!important;">
                            <p:outputLabel value="Cancelled" rendered="#{bs.bill.cancelled==true}"/>
                            <p:outputLabel value="Refunded" rendered="#{bs.bill.refunded==true}"/>
                        </p:column>

                        <p:column style="width: 5px!important;">
                            <p:outputLabel value="#{bs.bill.creditCompany.institutionCode}"/>
                        </p:column>

                        <p:column style="width: 10px!important;">
                            <p:outputLabel value="Absent" rendered="#{bs.absent}"/>
                        </p:column>

                    </p:selectOneListbox>
                </div>

            </p:panel>


        </h:form>
    </ui:define>
</ui:composition>