<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:bi="http://java.sun.com/jsf/composite/inward/bill" 
      xmlns:in="http://java.sun.com/jsf/composite/inward"
      xmlns:common="http://xmlns.jcp.org/jsf/composite/ezcomp/common">

    <h:body>

        <ui:composition template="/resources/template/template.xhtml">

            <ui:define name="content">
                <h:form>
                    <p:panel rendered="#{inwardSearch.patient.person ne null}">
                        <p:panel styleClass="alignTop" rendered="#{inwardSearch.patient.person ne null}" class="">
                            <f:facet name="header">
                                <div class="d-flex justify-content-between">
                                    <div class="d-flex">
                                        <h:outputText styleClass="fas fa-print"></h:outputText>
                                        <h:outputLabel value="Final Bill" class="mx-4"></h:outputLabel>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <p:commandButton 
                                            icon=" fa fa-refresh"
                                            value="Refresh Bill" 
                                            action="#" 
                                            ajax="false" />
                                        <p:commandButton 
                                            ajax="false" 
                                            icon="fa fa-cancel"
                                            class="ui-button-danger"
                                            value="To Cancel Bill"                                     
                                            action="inward_cancel_bill_final" 
                                            disabled="#{inwardSearch.bill.cancelled}"  />
                                    </div>
                                </div>

                                <h:panelGroup id="claimablePatientCopy2"></h:panelGroup>
                                <h:panelGroup id="letter"></h:panelGroup>

                            </f:facet>

                            <div class="d-flex justify-content-between mb-2" style="display: none;">
                                <div></div>
                                <div class="d-flex gap-2">
                                    <p:commandButton value="Final Bill &amp; Profesional Bill - Single page" ajax="false">
                                        <p:printer target="claimablePatientCopy2" ></p:printer>
                                    </p:commandButton>
                                    <p:commandButton value="Final Bill &amp; Profesional Bill - 3 pages" ajax="false">
                                        <p:printer  ></p:printer>
                                    </p:commandButton> 
                                    <p:commandButton value="Final Bill &amp; Profesional Bill (Duplicate)" ajax="false">
                                        <p:printer  ></p:printer>
                                    </p:commandButton>
                                    <p:commandButton value="Print Credit Company Letter" ajax="false">
                                        <p:printer target="letter" ></p:printer>
                                    </p:commandButton>
                                </div>
                            </div>

                            <!-- <div class="row" >
                                                            <div class="col-md-6">
                                                                <p:panel header="Claimable Bill Reprints" 
                                                                         rendered="#{inwardSearch.bill.patientEncounter.admissionType.admissionTypeEnum ne 'DayCase' }">                            
                                                                    <h:panelGrid columns="1">
                                                                        <p:commandButton value="Print Patient Copy" ajax="false">
                                                                            <p:printer target="claimablePatientCopy" ></p:printer>
                                                                        </p:commandButton>   
                                                                        <p:commandButton value="Print Patient Copy(Invoice)" ajax="false"  rendered="false" >
                                                                            <p:printer target="claimablePatientCopy2" ></p:printer>
                                                                        </p:commandButton>   
                                                                        <p:commandButton value="Print Patient Detailed Copy" ajax="false">
                                                                            <p:printer target="claimablePatientDetailCopy" ></p:printer>
                                                                        </p:commandButton>   
                                                                        <p:commandButton value="Print Duplicate Copy" ajax="false"  >
                                                                            <p:printer target="claimableDuplicate" ></p:printer>
                                                                        </p:commandButton>
                            
                                                                        <p:commandButton value="Print Credit Company Letter" ajax="false"  >
                                                                            <p:printer target="letter" ></p:printer>
                                                                        </p:commandButton>
                            
                            
                                                                    </h:panelGrid>
                                                                </p:panel>
                                                                <p:panel header="Non Claimable Bill Reprints" rendered="#{inwardSearch.bill.patientEncounter.admissionType.admissionTypeEnum ne 'DayCase'}">
                                                                    <h:panelGrid columns="1">
                                                                        <p:commandButton value="Patient Copy without Professional" ajax="false">
                                                                            <p:printer target="notClaimablePatientCopy" ></p:printer>
                                                                        </p:commandButton>                              
                                                                        <p:commandButton value="Duplicate wihout Professional" ajax="false">
                                                                            <p:printer target="notClaimableDuplicate" ></p:printer>
                                                                        </p:commandButton>  
                                                                        <p:commandButton value="Professional Fees" ajax="false">
                                                                            <p:printer target="professional" ></p:printer>
                                                                        </p:commandButton>
                                                                    </h:panelGrid>
                                                                </p:panel>
                                                                <p:panel header="Claimable Bill Reprints" rendered="#{inwardSearch.bill.patientEncounter.admissionType.admissionTypeEnum eq 'DayCase'}">                            
                                                                    <h:panelGrid columns="1">
                                                                        <p:commandButton ajax="false" value="Green Sheet Print"  >
                                                                            <p:printer target="finalBillGreenSheet" ></p:printer>
                                                                        </p:commandButton>
                                                                    </h:panelGrid>
                                                                </p:panel>
                                                                <p:panel header="Non Claimable Bill Reprints" rendered="#{inwardSearch.bill.patientEncounter.admissionType.admissionTypeEnum eq 'DayCase'}">
                                                                    <h:panelGrid columns="1">
                                                                        <p:commandButton ajax="false" value="Green Sheet Print Without Professional">
                                                                            <p:printer target="finalBillGreenSheetWithoutPro" ></p:printer>
                                                                        </p:commandButton>
                                                                        <p:commandButton value="Professional Fees" ajax="false">
                                                                            <p:printer target="professional" ></p:printer>
                                                                        </p:commandButton>
                                                                    </h:panelGrid>
                                                                </p:panel>
                            
                                                            </div>
                                                        </div>-->

                            <div class="row mt-3">
                                <div class="col-lg-4">
                                    <common:patient_details searchable="false" controller="#{admissionController}" class="w-100" />
                                </div>
                                <div class="col-lg-4">
                                    <common:admission_details admission="#{admissionController.current}" class="w-100"/>
                                </div>
                                <div class="col-lg-4">
                                    <p:panel>
                                        <f:facet name="header">
                                            <h:outputText styleClass="fas fa-file-invoice"></h:outputText>
                                            <h:outputLabel value="Bill Detail" class="mx-4"></h:outputLabel>
                                        </f:facet>

                                        <div class="row">
                                            <div class="col-md-5">
                                                <h:outputLabel value="Bill No" ></h:outputLabel>
                                            </div>
                                            <div class="col-md-1 justify-content-end d-flex">
                                                <p:outputLabel value=":" class="mx-2"/>
                                            </div>
                                            <div class="col-md-6">
                                                <h:outputLabel value="#{inwardSearch.bill.insId}" style="float: right;"></h:outputLabel>
                                            </div>
                                        </div> 

                                        <div class="row">
                                            <div class="col-md-5">
                                                <h:outputLabel value="Total" ></h:outputLabel>
                                            </div>
                                            <div class="col-md-1 justify-content-end d-flex">
                                                <p:outputLabel value=":" class="mx-2"/>
                                            </div>
                                            <div class="col-md-6">
                                                <h:outputLabel value="#{inwardSearch.bill.grantTotal}" style="float: right;" >
                                                    <f:convertNumber pattern="#,##0.00" />
                                                </h:outputLabel>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-5">
                                                <h:outputLabel value="Discount" ></h:outputLabel>
                                            </div>
                                            <div class="col-md-1 justify-content-end d-flex">
                                                <p:outputLabel value=":" class="mx-2"/>
                                            </div>
                                            <div class="col-md-6">
                                                <h:outputLabel value="#{inwardSearch.bill.discount}" style="float: right;" >
                                                    <f:convertNumber pattern="#,##0.00" />
                                                </h:outputLabel>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-5">
                                                <h:outputLabel value="Net Total" ></h:outputLabel>
                                            </div>
                                            <div class="col-md-1 justify-content-end d-flex">
                                                <p:outputLabel value=":" class="mx-2"/>
                                            </div>
                                            <div class="col-md-6">
                                                <h:outputLabel value="#{inwardSearch.bill.netTotal}" style="float: right;" >
                                                    <f:convertNumber pattern="#,##0.00" />
                                                </h:outputLabel>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-5">
                                                <h:outputLabel value="Paid Amount" ></h:outputLabel>
                                            </div>
                                            <div class="col-md-1 justify-content-end d-flex">
                                                <p:outputLabel value=":" class="mx-2"/>
                                            </div>
                                            <div class="col-md-6">
                                                <h:outputLabel value="#{inwardSearch.bill.paidAmount+inwardSearch.bill.patientEncounter.paidByCreditCompany}" style="float: right;" >
                                                    <f:convertNumber pattern="#,##0.00" />
                                                </h:outputLabel>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-5">
                                                <h:outputLabel value="Due " ></h:outputLabel>
                                            </div>
                                            <div class="col-md-1 justify-content-end d-flex">
                                                <p:outputLabel value=":" class="mx-2"/>
                                            </div>
                                            <div class="col-md-6">
                                                <h:outputLabel value="#{inwardSearch.bill.netTotal-(inwardSearch.bill.paidAmount+inwardSearch.bill.patientEncounter.paidByCreditCompany)}" style="float: right;" >
                                                    <f:convertNumber pattern="#,##0.00" />
                                                </h:outputLabel>
                                            </div>
                                        </div>

                                        <h:panelGroup rendered="#{inwardSearch.bill.patientEncounter.paymentMethod eq 'Credit'}">
                                            <div class="row">
                                                <div class="col-md-5 mt-2 d-flex gap-2">
                                                    <h:outputLabel value="Credit Limit" class="mt-2"/>
                                                    <p:commandButton 
                                                        ajax="false" 
                                                        icon="fa fa-pencil"
                                                        id="edit_credit_limit"
                                                        class="ui-button-warning"
                                                        action="#{inwardSearch.edit()}">
                                                    </p:commandButton>
                                                </div>
                                                <div class="col-md-1 justify-content-end d-flex mt-2">
                                                    <p:outputLabel value=":" class="mx-2 mt-2" />
                                                </div>
                                                <div class="col-md-6">
                                                    <p:inputText value="#{inwardSearch.bill.patientEncounter.creditLimit}" style="float: right;"  class="mt-2">
                                                        <f:convertNumber pattern="#,##0.00" />
                                                    </p:inputText>
                                                </div>
                                            </div>

                                            <p:tooltip for="edit_credit_limit" value="Edit Credit Limit"  showDelay="0" hideDelay="0"></p:tooltip>

                                        </h:panelGroup>

                                    </p:panel>
                                </div>
                            </div>

                            <div class="mt-2 mb-2">
                                <in:finalTable bill="#{inwardSearch.bill}"/>
                            </div>

                            <p:tabView rendered="true">
                                <p:tab title="Final Bill"  >  
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <p:panel header="Original">
                                                <bi:finalBill bill="#{inwardSearch.bill}"/>
                                            </p:panel>
                                        </div>
                                        <!--                                        <div class="col-lg-6">
                                                                                    <p:panel header="Duplicate">
                                                                                        <bi:finalBill bill="#{inwardSearch.bill}" duplicate="true"/>
                                                                                    </p:panel>
                                                                                </div>-->
                                    </div>

                                </p:tab>

                                <p:tab title="Hospital Bill" >
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <p:panel header="Original">
                                                <bi:finalBill bill="#{inwardSearch.bill}" hosCopy="true" /><!-- **Hospital Bill**Original Bill**-->
                                                <bi:finalBill bill="#{inwardSearch.bill}" hosCopy="true" showProfessional="true" /><!-- **Hospital Bill**Original Bill**-->

                                            </p:panel>
                                        </div>
                                        <div class="col-lg-6">
                                            <p:panel header="Duplicate">
                                                <bi:finalBill bill="#{inwardSearch.bill}" duplicate="true"/><!-- Final Bill - **Hospital Bill**Duplicate Bill**-->
                                                <bi:finalBill bill="#{inwardSearch.bill}" duplicate="true" showProfessional="true" /><!-- **Hospital Bill**Original Bill**-->
                                            </p:panel>
                                        </div>
                                    </div>
                                </p:tab>

                                <p:tab title="Professional Bill" >
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <p:panel header="Original">
                                                <bi:finalProfessionalBill bill="#{inwardSearch.bill}" /><!-- **Professional Bill**Original Bill**-->
                                            </p:panel>
                                        </div>
                                        <div class="col-lg-6">
                                            <p:panel header="Duplicate">
                                                <bi:finalProfessionalBill bill="#{inwardSearch.bill}" duplicate="true" /><!-- Final Bill - **Professional Bill**Duplicate Bill**-->
                                            </p:panel>
                                        </div>
                                    </div>
                                </p:tab>

                                <p:tab title="Final Bill Summary" >
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <p:panel header="Original">
                                                <bi:finalBillGreenSheet  bill="#{inwardSearch.bill}" />
                                                <bi:finalBillGreenSheet  bill="#{inwardSearch.bill}" showProfessional="true"/>
                                            </p:panel>
                                        </div>
                                        <div class="col-lg-6">
                                            <p:panel header="Duplicate">
                                                <bi:finalBillGreenSheet  bill="#{inwardSearch.bill}" duplicate="true"/>
                                                <bi:finalBillGreenSheet  bill="#{inwardSearch.bill}" duplicate="true" showProfessional="true"/>
                                            </p:panel>
                                        </div>
                                    </div>
                                </p:tab>

                                <p:tab title="Credit Company Letter">
                                    <h:panelGroup id="letter">
                                        <bi:credit_company_letter_new bill="#{inwardSearch.bill}"/> 
                                    </h:panelGroup>
                                </p:tab>
                            </p:tabView>





                        </p:panel>



                        <p:panel rendered="false" header="Final Bill">
                            <bi:finalBill bill="#{inwardSearch.bill}"/> **Original Bill**
                            <bi:finalBill bill="#{inwardSearch.bill}" hosCopy="true"/> Final Bill - **Hospital Bill**Original Bill**
                            <bi:finalBill bill="#{inwardSearch.bill}" hosCopy="true" showProfessional="true" /> **Hospital Bill**Original Bill**
                            <bi:finalBill bill="#{inwardSearch.bill}" duplicate="true"/> Final Bill - **Hospital Bill**Duplicate Bill**
                            <bi:finalBill bill="#{inwardSearch.bill}" duplicate="true" showProfessional="true" /> Final Bill - **Hospital Bill**Duplicate Bill**


                        </p:panel>

                        <p:panel rendered="false" header="Professional Bill">
                            <bi:finalProfessionalBill bill="#{inwardSearch.bill}" hosCopy="true" />
                            <bi:finalProfessionalBill bill="#{inwardSearch.bill}" duplicate="true" />
                        </p:panel>









                        <p:panel rendered="false">
                            <bi:finalBill  bill="#{inwardSearch.bill}" /> 
                            <bi:finalBill  bill="#{inwardSearch.bill}" hosCopy="true"/>
                            <bi:finalBill  bill="#{inwardSearch.bill}" duplicate="true"/>
                            <bi:finalBill hosCopy="true" showProfessional="true"  bill="#{inwardSearch.bill}"/>                 
                            <bi:finalBill duplicate="true" showProfessional="true" bill="#{inwardSearch.bill}" />

                            <bi:finalBill_1 bill="#{inwardSearch.bill}" hosCopy="true"/>
                            <bi:finalBill_1 bill="#{inwardSearch.bill}" duplicate="true"/> 

                            <bi:finalProfessionalBill bill="#{inwardSearch.bill}" hosCopy="true" />
                            <bi:finalProfessionalBill bill="#{inwardSearch.bill}" duplicate="true" />
                            <bi:finalProfessionalBill bill="#{inwardSearch.bill}" /> 

                            <bi:finalBillGreenSheet  bill="#{inwardSearch.bill}" showProfessional="true"/>               
                            <bi:finalBillGreenSheet  bill="#{inwardSearch.bill}" showProfessional="false"/>


                            <div style="width: 100%; text-align: center; margin: auto; padding: 10px; " >

                                <div>
                                    <p:dataTable id="pharmacy" value="#{bhtSummeryFinalizedController.pharmacyItems}" var="iss" 
                                                 sortBy="#{iss.bill.deptId}"
                                                 rowStyleClass="#{(iss.bill.netTotal ne 0 )                                                                       
                                                                  and                                                                        
                                                                  ((iss.bill.billClass eq 'class com.divudi.entity.PreBill')
                                                                  or 
                                                                  (iss.bill.billedBill ne null 
                                                                  and iss.bill.billClass eq 'class com.divudi.entity.RefundBill'))? '':'noDisplayRow'}">
                                        <p:column headerText="Bill No">
                                            <f:facet name="header">
                                                <h:outputLabel value="Bill No"/>
                                            </f:facet>
                                            <h:outputLabel value="#{iss.bill.deptId}"/>                                    
                                        </p:column>                  
                                        <p:column headerText="Item Name">
                                            <f:facet name="header">
                                                <h:outputLabel value="Item Name"/>
                                            </f:facet>
                                            <h:outputLabel  value="#{iss.item.name}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column headerText="Qty">
                                            <f:facet name="header">
                                                <h:outputLabel value="Qty"/>
                                            </f:facet>
                                            <h:outputLabel  value="#{iss.qty}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>                               
                                        <p:column style="text-align: right;" headerText="Total Value"  exportable="false">
                                            <h:outputLabel  value="#{iss.grossValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column style="text-align: right;" headerText="Margin Value" exportable="false">
                                            <h:outputLabel  value="#{iss.marginValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column style="text-align: right;" headerText="Gross Value" >
                                            <f:facet name="header">
                                                <h:outputLabel value="Gross Value"/>
                                            </f:facet>
                                            <h:outputLabel  value="#{iss.grossValue+iss.marginValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column style="text-align: right;" headerText="Discount Value">
                                            <f:facet name="header">
                                                <h:outputLabel value="Discount Value"/>
                                            </f:facet>
                                            <h:outputLabel  value="#{iss.discount}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column style="text-align: right;" headerText="Net Value">
                                            <f:facet name="header">
                                                <h:outputLabel value="Net Value"/>
                                            </f:facet>
                                            <h:outputLabel  value="#{iss.netValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>
                                        <p:column style="text-align: right;" headerText="Adjusted Value">
                                            <f:facet name="header">
                                                <h:outputLabel value="Adjusted Value"/>
                                            </f:facet>
                                            <h:outputLabel  value="#{iss.adjustedValue}">
                                                <f:convertNumber pattern="#,##0.00"/>
                                            </h:outputLabel>
                                        </p:column>

                                        <p:column headerText="Created At" exportable="false">
                                            <f:facet name="header">
                                                <h:outputLabel value="Created At"/> 
                                            </f:facet>
                                            <h:outputLabel value="#{iss.bill.createdAt}">
                                                <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                            </h:outputLabel>                                                   
                                            <br/>
                                            <h:panelGroup rendered="#{iss.bill.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled at " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.bill.cancelled}" 
                                                               value="#{iss.bill.cancelledBill.createdAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>

                                        <p:column headerText="Billed By" exportable="false" >
                                            <f:facet name="header">
                                                <h:outputLabel value="Billed By"/> 
                                            </f:facet>
                                            <h:outputLabel value="#{iss.bill.creater.webUserPerson.name}"/>     
                                            <br/>
                                            <h:panelGroup rendered="#{iss.bill.cancelled}" >
                                                <h:outputLabel style="color: red;" value="Cancelled By " />
                                                <h:outputLabel style="color: red;" rendered="#{iss.bill.cancelled}" 
                                                               value="#{iss.bill.cancelledBill.creater.webUserPerson.name}" >                                       
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>   
                                        <p:column headerText="Edited" exportable="false">
                                            <f:facet name="header">
                                                <h:outputLabel value="Edited"/> 
                                            </f:facet>
                                            <h:panelGroup  rendered="#{iss.bill.editor ne null}" >
                                                <h:outputLabel style="color: #008000;" value="Edited By " />
                                                <h:outputLabel style="color: #008000;" 
                                                               value="#{iss.bill.editor.webUserPerson.name}" >
                                                </h:outputLabel>
                                            </h:panelGroup>
                                            <h:panelGroup  rendered="#{iss.bill.editedAt ne null}" >
                                                <h:outputLabel style="color: #008000;" value="Edited at " />
                                                <h:outputLabel style="color: #008000;" 
                                                               value="#{iss.bill.editedAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>
                                        </p:column>
                                        <p:column headerText="Checked" exportable="false">
                                            <f:facet name="header">
                                                <h:outputLabel value="Checked"/> 
                                            </f:facet>
                                            <h:panelGroup  rendered="#{iss.bill.checkedBy ne null}" >

                                                <h:outputLabel style="color: #008000;" 
                                                               value="#{iss.bill.checkedBy.webUserPerson.name}" >
                                                </h:outputLabel>
                                            </h:panelGroup><br/>
                                            <h:panelGroup  rendered="#{iss.bill.checkeAt ne null}" >

                                                <h:outputLabel style="color: #008000;" 
                                                               value="#{iss.bill.checkeAt}" >
                                                    <f:convertDateTime  timeZone="Asia/Colombo" pattern="#{sessionController.applicationPreference.longDateTimeFormat}" />
                                                </h:outputLabel>
                                            </h:panelGroup>                        
                                        </p:column>

                                    </p:dataTable>
                                </div>
                            </div>

                        </p:panel>


                        <h:outputStylesheet library="css" name="printing.css" ></h:outputStylesheet>

                    </p:panel>
                </h:form>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
